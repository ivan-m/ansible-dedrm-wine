---

- name: Check if wine prefix already exists
  stat:
    path: "{{ wine_prefix }}"
  register: wine_prefix_check

- set_fact:
    have_prefix: "{{ wine_prefix_check.stat.isdir is defined and wine_prefix_check.stat.isdir }}"

- name: Prefix already exists
  debug:
    msg: "{{ wine_prefix }} already exists"
  when: have_prefix | bool

- name: "Create wine prefix {{ wine_prefix }}"
  command:
    cmd: wine wineboot --init
    creates: "{{ wine_prefix }}"
      # This duplicates the when conditional check
  when: not have_prefix | bool

- name: "Find out what is installed already with winetricks"
  command:
    winetricks --unattended list-installed
  register: winetricks_installed
  # This should have no side effects
  changed_when: false

- name: Clean up installed list
  set_fact:
    winetricks_installed: "{{ winetricks_installed.stdout }}"
